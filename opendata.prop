db.url = jdbc:mysql://gauss/abi
db.user = abi
db.pass =

csv.fs = ;

temp.dir = opendata/tmp

censite.query = \
	select \
		concat('IT-', isil_provincia, lpad(isil_numero, 4, 0)) as isil, \
		b.denominazione_ufficiale as nome \
	FROM \
		`stato_catalogazione` RIGHT OUTER JOIN `biblioteca` as b ON `stato_catalogazione`.`id_biblioteca` = `b`.`id_biblioteca` \
	where \
		stato_catalogazione.id_stato_catalogazione IS NULL \
		AND `b`.`id_stato_biblioteca_workflow` != 4 \
	ORDER BY isil ASC
	
censite.limit = 100

#territorio =
contatti =
#patrimonio =
#fondi-speciali =
tipologie = 
specializzazioni = 

territorio.query = \
	select \
		concat('IT-', isil_provincia, lpad(isil_numero, 4, 0)) as `codice isil`, \
		b.`indirizzo`, \
		`b`.`frazione`, \
		`c`.`denominazione` AS `comune`, \
		`c`.`codice_istat` AS `codice istat comune`, \
		`p`.`denominazione` AS `provincia`, \
		`r`.`denominazione` AS `regione`, \
		`p`.`codice_istat` AS `codice istat provincia`, \
		`g`.`latitudine`, \
		`g`.`longitudine` \
	FROM \
		`stato_catalogazione` RIGHT OUTER JOIN `biblioteca` as b ON `stato_catalogazione`.`id_biblioteca` = `b`.`id_biblioteca`, \
		`comune` AS `c`, \
		`provincia` AS `p`, \
		`regione` AS `r`, \
		`geolocalizzazione` AS `g` \
	WHERE \
		`b`.`id_comune` = `c`.`id_comune` \
		AND `c`.`id_provincia` = `p`.`id_provincia` \
		AND `p`.`id_regione` = `r`.`id_regione` \
		AND `g`.`id_biblioteca` = `b`.`id_biblioteca` \
		AND `stato_catalogazione`.`id_stato_catalogazione` IS NULL \
		AND `b`.`id_stato_biblioteca_workflow` != 4 \
	ORDER BY `codice isil` ASC, `comune` ASC, `provincia` ASC
	
territorio.file = territorio.csv

patrimonio.query = \
	SELECT \
		`patrimonio_specializzazione`.`descrizione` AS `nome`, \
		`patrimonio_specializzazione_categoria`.`descrizione` AS `categoria`, \
		`patrimonio`.`quantita`, \
		`patrimonio`.`quantita_ultimo_anno` AS `acquisti-ultimo-anno` \
	FROM \
		`stato_catalogazione` RIGHT OUTER JOIN `biblioteca` as biblioteca ON `stato_catalogazione`.`id_biblioteca` = `biblioteca`.`id_biblioteca`, \
		`patrimonio` AS `patrimonio`, \
		`patrimonio_specializzazione` AS `patrimonio_specializzazione`, \
		`patrimonio_specializzazione_categoria` AS `patrimonio_specializzazione_categoria` \
	WHERE \
		`patrimonio`.`id_biblioteca` = `biblioteca`.`id_biblioteca` \
		AND `patrimonio`.`id_patrimonio_specializzazione` = `patrimonio_specializzazione`.`id_patrimonio_specializzazione` \
		AND `patrimonio_specializzazione`.`id_patrimonio_specializzazione_categoria` = `patrimonio_specializzazione_categoria`.`id_patrimonio_specializzazione_categoria` \
		AND CONCAT( `isil_stato`, '-', `isil_provincia`, lpad( `isil_numero`, 4, 0 ) ) = ? \
		AND `stato_catalogazione`.`id_stato_catalogazione` IS NULL
		
patrimonio.file = patrimonio.xml

contatti.query = \
	SELECT \
		`contatti`.`valore` as contatto, \
		`contatti`.`note`, \
		`contatti_tipo`.`descrizione` as `tipo` \
	FROM \
		`stato_catalogazione` RIGHT OUTER JOIN `biblioteca` as biblioteca ON `stato_catalogazione`.`id_biblioteca` = `biblioteca`.`id_biblioteca`, \
		`contatti` AS `contatti`, \
		`contatti_tipo` AS `contatti_tipo` \
	WHERE \
		`contatti`.`id_biblioteca` = `biblioteca`.`id_biblioteca` \
		AND `contatti`.`id_contatti_tipi` = `contatti_tipo`.`id_contatti_tipo` \
		and CONCAT(isil_stato, '-', isil_provincia, lpad(isil_numero, 4, 0)) = ? \
  order by tipo
  
contatti.file = contatti.xml

fondi-speciali.query = \
  SELECT \
  	`fondi_speciali`.`denominazione` AS `nome`, \
  	`fondi_speciali`.`descrizione` AS `descrizione`, \
  	`fondi_speciali`.`id_dewey` AS `dewey`, \
  	`dewey`.`descrizione` AS `dewey-testo` \
  FROM \
  	`fondi_speciali` AS `fondi_speciali`, \
  	`dewey` AS `dewey`, \
  	`biblioteca_has_fondi_speciali` AS `biblioteca_has_fondi_speciali`, \
		`stato_catalogazione` AS `stato_catalogazione` RIGHT OUTER JOIN `biblioteca` AS `biblioteca` ON `stato_catalogazione`.`id_biblioteca` = `biblioteca`.`id_biblioteca` \
  WHERE \
  	`fondi_speciali`.`id_dewey` = `dewey`.`id_dewey` \
  	AND `biblioteca_has_fondi_speciali`.`id_biblioteca` = `biblioteca`.`id_biblioteca` \
  	AND `biblioteca_has_fondi_speciali`.`id_fondi_speciali` = `fondi_speciali`.`id_fondi_speciali` \
  	AND CONCAT( 'IT-', `isil_provincia`, lpad( `isil_numero`, 4, 0 ) ) = ? \
		AND `stato_catalogazione`.`id_stato_catalogazione` IS NULL
		
fondi-speciali.file = fondi-speciali.xml  

tipologie.query = \
	SELECT \
		concat('IT-', isil_provincia, lpad(isil_numero, 4, 0)) as isil, \
		`tipologia_funzionale`.`descrizione` AS `tipologia biblioteca`, \
		`ente`.`denominazione` AS `ente`, \
		`ente_tipologia_amministrativa`.`descrizione` AS `tipologia ente` \
	FROM \
		`stato_catalogazione` RIGHT OUTER JOIN `biblioteca` as b ON `stato_catalogazione`.`id_biblioteca` = `b`.`id_biblioteca`, \
		`ente` AS `ente`, \
		`ente_tipologia_amministrativa` AS `ente_tipologia_amministrativa`, \
		`tipologia_funzionale` AS `tipologia_funzionale` \
	WHERE \
		`b`.`id_ente` = `ente`.`id_ente` \
		AND `ente`.`id_ente_tipologia_amministrativa` = `ente_tipologia_amministrativa`.`id_ente_tipologia_amministrativa` \
		AND `b`.`id_tipologia_funzionale` = `tipologia_funzionale`.`id_tipologia_funzionale` \
		AND `stato_catalogazione`.`id_stato_catalogazione` IS NULL \
		AND `b`.`id_stato_biblioteca_workflow` != 4 \
	order by concat('IT-', isil_provincia, lpad(isil_numero, 4, 0))

tipologie.file = tipologie.csv

specializzazioni.query = \
	SELECT \
		`dewey`.`id_dewey` AS `codice`, \
		`dewey`.`descrizione` AS 'dewey-testo' \
	FROM \
		`biblioteca_has_dewey` AS `biblioteca_has_dewey`, \
		`biblioteca` AS `biblioteca`, \
		`dewey` AS `dewey` \
	WHERE \
		`biblioteca_has_dewey`.`id_biblioteca` = `biblioteca`.`id_biblioteca` \
		AND `biblioteca_has_dewey`.`id_dewey` = `dewey`.`id_dewey` \
		AND CONCAT( 'IT-', `isil_provincia`, lpad( `isil_numero`, 4, 0 ) ) = ? \
	order by `dewey`.`id_dewey`
	
specializzazioni.file = specializzazioni.xml